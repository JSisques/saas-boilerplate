// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "linux-arm64-openssl-3.0.x", "linux-musl-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRoleEnum {
  ADMIN
  USER
}

enum StatusEnum {
  ACTIVE
  INACTIVE
  BLOCKED
}

model User {
  id        String       @id @default(uuid())
  userName  String?      @unique
  name      String? // Name of the user
  lastName  String? // Last name of the user
  bio       String? // Bio of the user
  avatarUrl String? // Avatar URL of the user
  role      UserRoleEnum // Role of the user
  status    StatusEnum

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  auth    Auth[]
  tenants TenantMember[]

  @@index([userName])
}

enum TenantMemberRoleEnum {
  OWNER
  ADMIN
  MEMBER
  GUEST
}

model TenantMember {
  id       String               @id @default(uuid())
  tenantId String // Tenant ID
  userId   String // User ID
  role     TenantMemberRoleEnum // Role of the tenant member

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user   User   @relation(fields: [userId], references: [id])
  tenant Tenant @relation(fields: [tenantId], references: [id])

  @@index([tenantId, userId])
}

enum TenantStatusEnum {
  ACTIVE
  INACTIVE
  BLOCKED
}

model Tenant {
  id             String           @id @default(uuid())
  name           String // Name of the tenant
  slug           String           @unique // Slug of the tenant
  description    String? // Description of the tenant
  websiteUrl     String? // Website URL of the tenant
  logoUrl        String? // Logo URL of the tenant
  faviconUrl     String? // Favicon URL of the tenant
  primaryColor   String? // Primary color of the tenant
  secondaryColor String? // Secondary color of the tenant
  status         TenantStatusEnum @default(ACTIVE) // Status of the tenant
  // Contact information
  email          String? // Email of the tenant
  phoneNumber    String? // Phone number of the tenant
  phoneCode      String? // Phone code of the tenant
  address        String? // Address of the tenant
  city           String? // City of the tenant
  state          String? // State of the tenant
  country        String? // Country of the tenant
  postalCode     String? // Postal code of the tenant
  timezone       String           @default("UTC") // Timezone
  locale         String           @default("en") // Language/region

  // Limits and quotas
  maxUsers    Int? // Max users
  maxStorage  Int? // Max storage (bytes)
  maxApiCalls Int? // Max API calls per month

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relationships
  members TenantMember[]
  subscription Subscription? 
}

model Event {
  id            String   @id @default(uuid())
  eventType     String // Event type
  aggregateType String // Aggregate type
  aggregateId   String // Aggregate ID
  payload       Json? // Payload
  timestamp     DateTime @default(now()) // Timestamp

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum AuthProviderEnum {
  LOCAL
  GOOGLE
  APPLE
}

model Auth {
  id               String           @id @default(uuid())
  provider         AuthProviderEnum // Provider of the auth
  providerId       String? // Provider ID
  email            String?          @unique // Email of the auth
  phoneNumber      String? // Phone number of the auth
  password         String? // Password of the auth
  emailVerified    Boolean          @default(false) // Email verified
  twoFactorEnabled Boolean          @default(false) // Two factor enabled
  lastLoginAt      DateTime? // Last login at

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  userId String
  user   User   @relation(fields: [userId], references: [id])
}


enum SubscriptionPlanIntervalEnum {
  MONTHLY
  YEARLY
}

enum CurrencyEnum {
  USD
  EUR
}

enum SubscriptionPlanTypeEnum {
  FREE
  BASIC
  PRO
  ENTERPRISE
}
model SubscriptionPlan{
  id String @id @default(uuid())
  name String // Name of the plan
  slug String @unique // Slug of the plan
  type SubscriptionPlanTypeEnum // Type of the plan
  description String? // Description of the plan
  priceMonthly Decimal // Price of the plan
  priceYearly Decimal // Price of the plan
  currency CurrencyEnum // Currency of the plan (USD, EUR, GBP, etc.)
  interval SubscriptionPlanIntervalEnum // Interval of the plan
  intervalCount Int // Interval count of the plan
  trialPeriodDays Int? // Trial period days of the plan
  isActive Boolean @default(true) // Is active plan
  features Json? // Features of the plan
  limits Json? // Limits of the plan
  stripePriceId String? // Stripe price ID of the plan

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum RenewalMethodEnum {
  MANUAL
  AUTOMATIC
}
enum SubscriptionStatusEnum {
  ACTIVE
  INACTIVE
  CANCELLED
  REFUNDED
}


model Subscription{
  id String @id @default(uuid())
  tenantId String @unique // Tenant ID
  planId String // Plan ID
  startDate DateTime // Start date of the subscription
  endDate DateTime // End date of the subscription
  trialEndDate DateTime? // Trial end date of the subscription
  status SubscriptionStatusEnum // Status of the subscription
  stripeSubscriptionId String? // Stripe subscription ID of the subscription
  stripeCustomerId String? // Stripe customer ID of the subscription
  renewalMethod RenewalMethodEnum @default(AUTOMATIC) // Renewal method of the subscription

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  tenant Tenant @relation(fields: [tenantId], references: [id])
}


enum SubscriptionPaymentStatusEnum {
  PENDING
  PAID
  FAILED
  REFUNDED
}

enum PaymentMethodEnum {
  CREDIT_CARD
  DEBIT_CARD
  PAYPAL
  STRIPE
}
model SubscriptionPayment{
  id String @id @default(uuid())
  subscriptionId String // Subscription ID
  amount Decimal // Amount of the payment
  currency CurrencyEnum // Currency of the payment
  status SubscriptionPaymentStatusEnum // Status of the payment
  paymentMethod PaymentMethodEnum // Payment method of the payment
  invoiceNumber String? // Invoice number of the payment
  stripeInvoiceId String? // Stripe invoice ID of the payment
  paidAt DateTime? // Paid at of the payment

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}